@page "/admin/mw5e/characters/{CharacterId}/edit"
@using Larp.Landing.Client.Pages.MwFifth
@inject LandingService LandingService
@inject NavigationManager NavigationManager

<PageHeader>Mystwood 5e Characters</PageHeader>

<AdminLayout Loading="_isLoading">
    <MwFifthCharacterEditor Admin CharacterId="@CharacterId" />
</AdminLayout>

@code {

    [Parameter]
    public string CharacterId { get; set; } = default!;

    bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var character = await LandingService.Admin.GetMwFifthCharacterLatest(CharacterId);
        if (character.Revision.RevisionId != CharacterId)
        {
            NavigationManager.NavigateTo($"/admin/mw5e/characters/{character.Revision}/edit", replace: true);
            await OnInitializedAsync();
            return;
        }
        _isLoading = false;
    }

    protected override async Task OnParametersSetAsync()
    {
        _isLoading = true;
        await OnInitializedAsync();
    }
}