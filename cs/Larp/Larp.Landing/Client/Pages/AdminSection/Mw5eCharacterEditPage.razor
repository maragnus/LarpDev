@page "/admin/mw5e/characters/{CharacterId}/edit"
@using Larp.Landing.Client.Pages.MwFifth
@inject LandingService LandingService
@inject NavigationManager NavigationManager

<PageHeader>Mystwood 5e Characters</PageHeader>

<AdminLayout>
    @if (!_loaded)
    {
        <MudProgressCircular Indeterminate Size="Size.Large"/>
    }
    else
    {
        <MwFifthCharacterEditor Admin CharacterId="@CharacterId" />
    }
</AdminLayout>

@code {

    [Parameter]
    public string CharacterId { get; set; } = null!;

    bool _loaded;

    protected override async Task OnInitializedAsync()
    {
        var character = await LandingService.Admin.GetMwFifthCharacterLatest(CharacterId);
        if (character.Id != CharacterId)
        {
            NavigationManager.NavigateTo($"/admin/mw5e/characters/{character.Id}/edit", replace: true);
            await OnInitializedAsync();
            return;
        }
        _loaded = true;
    }

    protected override async Task OnParametersSetAsync()
    {
        await OnInitializedAsync();
    }
}